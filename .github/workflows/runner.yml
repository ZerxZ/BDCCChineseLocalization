name: Build BDDC Chinese Localization Nightly
on:
  workflow_dispatch:
  schedule:
    - cron: '15 13 * * *'
  push:
  pull_request: 

permissions: write-all

env:
  GODOT_VERSION: "3.5.2"
  PARATRANZ_TOKEN: ${{ secrets.PARATRANZ_TOKEN }}
  PARATRANZ_PROJECT: ${{ secrets.PARATRANZ_PROJECT }}
  
jobs:
  translate:
    name: üåê Translate
    runs-on: windows-latest
    steps:
      - name: Check Submodules
        uses: actions/checkout@v4
        with: 
            submodules: recursive
      
      - name: Set up .NET Sdk
        uses: actions/setup-dotnet@v4
        with:
          dotnet-version: "8.0.x"
      
      - name: Run translation
        run: dotnet run --project BDCCChineseLocalization Translate ${{ env.PARATRANZ_TOKEN }} ${{ env.PARATRANZ_PROJECT }}
      - name: Upload translation artifact
        uses: actions/upload-artifact@v4
        with:
          name: bdcc-chinese-translation
          path: ./BdccChineseLocalization.zip
          retention-days: 7
          
          
  build:
    needs: translate
    name: üèóÔ∏è Build
    runs-on: ubuntu-latest
    container:
      image: barichello/godot-ci:3.5.3
    steps:
      - name: Download translation artifact
        uses: actions/download-artifact@v4
        with:
          name: bdcc-chinese-translation
      - name: Unzip translation artifact
        run: unzip BdccChineseLocalization.zip -d ./BdccChineseLocalization
      - name: Setup
        run: |
            mkdir -v -p ~/.local/share/godot/templates
            mv /root/.local/share/godot/templates/${GODOT_VERSION}.stable ~/.local/share/godot/templates/${GODOT_VERSION}.stable
      - name: Windows Build
        run: |
            mkdir -v -p build/windows
            godot -v --path ./BdccChineseLocalization --export "Windows Desktop" ./build/windows/$EXPORT_NAME.exe
      - name: Upload artifact
        uses: actions/upload-artifact@v4
        with:
          name: bdcc-windows
          path: ./build/windows/
          retention-days: 7
          